#!/usr/bin/env ruby

require_relative "../config/env"
require "drawing_visitor"
require "engine"
require "fetcher"
require "gosu_box_renderer"
require "gosu_text_renderer"
require "gui_window"
require "height_calculator"
require "layout_pipeline"
require "parser"
require "root_node_dimensions_setter"

uri = ARGV[0]

if uri.nil? || uri.empty?
  STDERR.puts("Usage: #{$0} a_web_address")
  exit(1)
end

browser = GuiWindow.new(
  engine: Engine.new(
    fetcher: Fetcher.new,
    layout_pipeline: LayoutPipeline.new(
      [
        RootNodeDimensionsSetter.method(:new),
        HeightCalculator.method(:new),
      ]
    ),
    parser: Parser.new,
  ),
  drawing_visitor_factory: DrawingVisitor.method(:new),
)

browser.address = uri
browser.go

browser.show
